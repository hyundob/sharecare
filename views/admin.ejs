<meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
	<script src="button_script.js"></script>
  	<link rel="stylesheet" href="./button_style.css">
    <title>ShareCare</title>
    <style>
        body,html {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
            background-color: #F6F6F6;
            min-width:80%;
        }

        .login {
	        height:10px;
	        margin-top:20px;
            margin-right: 20%;
	        float:right;
        }
		
		.logo {
			margin-top: 30px;
		}

        header {
            text-align: center;
            padding-top: 20px;
            padding-bottom: 5px;
        }
		
		

        .line {
            border-top: 1px solid #5a5a5a;
            margin: auto;
            width: 70rem; 
        }

        nav {
           
            text-align: center;
            
        }

        nav ul {
            font-size: 22px;
            list-style-type: none;
            padding: 0;
        }

        a:link { color: rgb(71, 71, 71); text-decoration: none;}
        
        a:visited { color: rgb(71, 71, 71); text-decoration: none;}
		a:hover { color: #20CE88; text-decoration: none;}
		


        nav li {
            display: inline;
            margin: 0 20px;
        }

        

        section {
            padding: 40px;
            text-align: center;
        }
		
		

        footer {
            background-color: #333;
            color: white;
            text-align: center;
            padding: 20px 0;
        }
		
        /* 게시판 리스트 */
        /* 게시판 목록 스타일 */
        body{
        line-height:2em;        
        font-family:"맑은 고딕";
        }
            ul, li{ 
                list-style:none;
                text-align:center;
                padding:0;
                margin:0;
        }

            #mainWrapper{
                width: 800px;
                margin: 0 auto; /*가운데 정렬*/
				margin-top: 50px;
            }

            #mainWrapper > ul > li:first-child {
                text-align: center;
                font-size:14pt;
                height:40px;
                vertical-align:middle;
                line-height:30px;
        }

            #ulTable {margin-top:10px;}
            

            #ulTable > li:first-child > ul > li {
                background-color:#DDD2C2;
                font-weight:bold;
                text-align:center;
        }

            #ulTable > li > ul {
                clear:both;
                padding:0px auto;
                position:relative;
                min-width:40px;
        }
            #ulTable > li > ul > li { 
                float:left;
                font-size:10pt;
                border-bottom:1px solid silver;
                vertical-align:baseline;
				height:40px;
        }    

            #ulTable > li > ul > li:first-child               {width:20%;} /*No 열 크기*/
            #ulTable > li > ul > li:first-child +li           {width:20%;} /*제목 열 크기*/
            #ulTable > li > ul > li:first-child +li+li        {width:20%;} /*작성일 열 크기*/
            #ulTable > li > ul > li:first-child +li+li+li     {width:20%;} /*작성자 열 크기*/
            #ulTable > li > ul > li:first-child +li+li+li+li{width:20%;} /*조회수 열 크기*/
            #ulTable {margin-top:10px;}
            

            #searchResults > li:first-child > ul > li {
                background-color:#c9c9c9;
                font-weight:bold;
                text-align:center;
        }

            #searchResults > li > ul {
                clear:both;
                padding:0px auto;
                position:relative;
                min-width:40px;
        }
            #searchResults > li > ul > li { 
                float:left;
                font-size:10pt;
                border-bottom:1px solid silver;
                vertical-align:baseline;
        }    

            #searchResults > li > ul > li:first-child               {width:20%;} /*No 열 크기*/
            #searchResults > li > ul > li:first-child +li           {width:20%;} /*제목 열 크기*/
            #searchResults > li > ul > li:first-child +li+li        {width:20%;} /*작성일 열 크기*/
            #searchResults > li > ul > li:first-child +li+li+li     {width:20%;} /*작성자 열 크기*/
            #searchResults > li > ul > li:first-child +li+li+li+li  {width:20%;} /*조회수 열 크기*/

            #divPaging {
                clear:both; 
                margin:0 auto; 
                width:220px; 
                height:50px;
        }

            #divPaging > div {
                float:left;
                width: 30px;
                margin:0 auto;
                text-align:center;
        }

            #liSearchOption {clear:both;}
            #liSearchOption > div {
                margin:0 auto; 
                margin-top: 30px; 
                width:auto; 
                height:100px;

        }

            .left {
                text-align : left;
        }
        
		.delete-button {
			margin:5px; 
			padding:5px 11px; 
			color:#fff !important; 
			display:inline-block;
			background-color:#C06769;
			vertical-align:middle; 
			border-radius:0 !important; 
			cursor:pointer; border:none;
		}
		#secession:hover {
			background:#ED736F;
		}
		
 

        footer {
            background-color: #333;
            color: white;
            text-align: center;
            padding: 20px 0;
        }
    </style>
</head>

<body>
<header>
	
    <nav class="login" id="loginNav">
        
        <a href="#" id="logoutLink">로그아웃</a>
    </nav>

    <br>

    <div class="logo">
        <a href="/index.html">
        <img src="../image/logo.png">
        </a>
    </div>
        
</header>
    
    <div class="line"></div>

    <nav>
        <ul>
            <li><a href="/000.introduce/introduce.html">소개</a></li>
            <li><a href="/index.html" >홈</a></li>
            <li><a href="/board1">운동</a></li>
            <li><a href="/board2">식단</a></li>
            <li><a href="/mypage">기록</a></li>
			<li><a href="/008.sharetalk/ShareTalk.html">셰어톡</a></li>
            <li><a href="/008.sharetalk/ShareTalk.html" style="color: #20CE88;">회원관리</a></li> 
        </ul>
    </nav>

    
    <div id="mainWrapper">
        <ul>
			<!-- 게시판 제목 -->
			<li><h1>회원 리스트</h1></li>
				
				<!-- 게시판 목록 -->
			<li>
               
                <ul id="searchResults"></ul>
				<ul id="ulTable">
					<li>
						<ul>
                    		<li><strong>회원번호</strong></li>
                    		<li><strong>아이디</strong></li> 
                            <li><strong>이메일</strong></li>
                    		<li><strong>이름</strong> </li>
                    		<li><strong>처리</strong></li>
                        </ul>
					</li>
                
 					<!-- 게시물 출력 -->
					<% for (let post of userList) { %>
                	<li class="member-list-item" data-board-id="<%= post.user_num %>">
						<ul>
                    		<li><%= post.user_num %></li>
                    		<li class="left"><%= post.uid %></li>
                            <li><%= post.email %></li> 
                    		<li><%= post.uname %></li>
                    		<li class="process">
                                <button class="delete-button" data-usernum="<%=post.user_num%>">탈퇴</button>
                            </li>
						</ul>
                	</li>
            		<% } %>
				</ul>
			</li>
            
            <li>
                <div id="divPaging">
                    <a href="/admin?page=1">◀</a>
                    <% for (let i = 1; i <= totalPages; i++) { %>
                    <a href="/admin?page=<%= i %>"><%= i %></a>
                    <% } %>
                    <a href="/admin?page=<%= totalPages %>">▶</a>
                </div>
            </li>
            <li id='liSearchOption'>
                <div>
                    <section>
                        <form id="searchForm">
                            <select id="searchOption">
                                <option value="user_num">회원번호</option>
                                <option value="uid">아이디</option>
                                <option value="uname">이름</option>
                            </select>
                            <input type="text" id="searchKeyword" placeholder="검색어를 입력하세요">
                            <input type="submit" value="검색">
                        </form>
                    </section>
                </div>
            </li>
        </ul>
    </div>
    <footer>
        &copy; 213005 문세희 | 2023 3학년 홈페이지 제작 능력 심사용 | ShareCare 
    </footer>
</body>
<script>
    function checkCookie(name) {
        var cookies = document.cookie.split(';');
        for(var i = 0; i < cookies.length; i++) {
            var c = cookies[i].trim();
            if (c.indexOf(name + '=') == 0) return true;
        }
        return false;
    }
    // 페이지 로드 시 실행되는 함수
    window.onload = function() {
        var isLoggedIn = document.cookie.includes('loggedIn');
        var loginNav = document.getElementById('loginNav');
        var logoutLink = document.getElementById('logoutLink');

        if (isLoggedIn) {
            logoutLink.addEventListener('click', function() {
                // 쿠키 삭제
                document.cookie = 'loggedIn=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/;';
                // index.html로 리다이렉트
                window.location.href = 'index.html';
            });
        } else {
            loginNav.innerHTML = '<a href="login.html">로그인</a>';
        }
    };

    /* 게시물 클릭 시 서버로 요청 보내는 스크립트
    document.addEventListener('DOMContentLoaded', function () {
        const boardList = document.querySelectorAll('.board-list-item');

        boardList.forEach(function (item) {
            item.addEventListener('click', function () {
                const boardId = item.getAttribute('data-board-id');

                // 게시물 클릭 시 서버로 요청 보내기
                fetch(`/board1/${boardId}/increase_read_count`, {
                    method: 'POST',
                })
                .then(response => response.json())
                .then(data => {
                    // 서버로부터 업데이트된 게시물 정보를 받아 화면에 표시
                    const readCountElement = item.querySelector('.read-count');
                    if (readCountElement) {
                        readCountElement.textContent = data.read_count;
                    }
                })
                .catch(error => console.error('Error:', error));
            });
        });
    }); */

    // 검색 폼 제출 시 실행되는 스크립트
    document.addEventListener('DOMContentLoaded', function () {
        document.getElementById('searchForm').addEventListener('submit', function(event) {
            event.preventDefault();
            const searchOption = document.getElementById('searchOption').value;
            const keyword = document.getElementById('searchKeyword').value;
            const currentPage = 1; // 검색을 시작할 때는 항상 첫 페이지부터

            fetch(`/api/search3?option=${searchOption}&keyword=${encodeURIComponent(keyword)}&page=${currentPage}`)
                .then(response => response.json())
                .then(data => {
                    updateBoardList(data); // 게시판 리스트 업데이트
                })
                .catch(error => console.error('Error:', error));
        });
        
        function updateBoardList(data) {
            const ulTable = document.getElementById('ulTable');
            ulTable.innerHTML = ''; // 기존 목록 제거
            ulTable.innerHTML = `
                <li>
                    <ul>
                    	<li><strong>회원번호</strong></li>
                    	<li><strong>아이디</strong></li> 
                        <li><strong>이메일</strong></li>
                    	<li><strong>이름</strong> </li>
                    	<li><strong>처리</strong></li>
                   </ul>
                </li>
            `;

            // 검색 결과를 반복하여 목록에 추가
            data.forEach(post => {
                const li = document.createElement('li');
                li.className = 'member-list-item';
                li.innerHTML = `
						
                    <ul>
                        <li>${post.user_num}</li>
                        <li class="left">${post.uid}</li>
                        <li>${post.email}</li>
                        <li>${post.uname}</li>
                        <li class="process">
                            <button class="delete-button" data-usernum="${post.user_num}">탈퇴</button>
                        </li>
                    </ul>
                `;
                ulTable.appendChild(li);
            });
        }
    });

    document.addEventListener('DOMContentLoaded', function () {
        const deleteButtons = document.querySelectorAll('.delete-button');
        deleteButtons.forEach(button => {
            button.addEventListener('click', function () {
                const userNum = this.getAttribute('data-usernum');
                console.log(userNum);
                if (confirm('해당 회원을 탈퇴시키겠습니까?')) {
                    fetch(`/delete-user/${userNum}`, {
                        method: 'DELETE'
                    })
                    .then(response => {
                        if (response.ok) {
                            alert('회원 탈퇴 처리가 완료되었습니다.');
                            // 페이지 새로고침 또는 목록 업데이트
                            location.reload();
                        } else {
                            alert('오류가 발생했습니다.');
                        }
                    })
                    .catch(error => console.error('Error:', error));
                }
            });
        });
    });
    
    document.addEventListener('DOMContentLoaded', function() {
        var logoutLink = document.getElementById('logoutLink');
        logoutLink.addEventListener('click', function(e) {
            e.preventDefault(); // 기본 링크 동작 방지

            fetch('/logout', { method: 'POST' }) // POST 요청으로 로그아웃 처리
                .then(response => {
                    if (response.ok) {
                        // 로그아웃 성공 시 홈페이지나 로그인 페이지로 리다이렉트
                        window.location.href = '/index.html';
                    } else {
                        alert('로그아웃 실패');
                    }
                })
                .catch(error => console.error('Error:', error));
        });
    });
    
</script>
</html>